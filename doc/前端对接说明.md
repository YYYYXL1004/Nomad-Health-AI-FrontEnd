# 牧民健康系统前端API对接说明

## 1. 基本信息

- 后端技术栈：Flask (Python)
- API基础URL：`http://localhost:5000`
- 请求格式：JSON
- 响应格式：JSON
- 身份验证：JWT Token

## 2. 通用响应格式

所有API响应都遵循以下统一格式：

```json
{
  "code": 200,          // 状态码，200表示成功，其他表示失败
  "message": "success", // 状态描述
  "data": {},           // 数据负载，可能是对象、数组或null
  "timestamp": 1746897859261 // 时间戳
}
```

常见状态码：
- 200: 成功
- 400: 请求参数错误
- 401: 未授权（需要登录）
- 403: 权限不足
- 404: 资源不存在
- 500: 服务器内部错误

## 3. 身份验证

系统使用JWT进行身份验证。登录成功后，后端会返回一个`token`，前端需要在后续请求中将该token放在请求头的`Authorization`字段中。

```js
// 登录后保存token
const token = response.data.token;
localStorage.setItem('token', token);

// 在请求中使用token
const headers = {
  'Authorization': `Bearer ${token}`,
  'Content-Type': 'application/json'
};
```

### 登录接口

- 请求方式：POST
- 接口路径：`/api/auth/login`
- 请求参数：

```json
{
  "account": "用户名/手机号",
  "password": "密码"
}
```

- 响应示例：

```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "account": "test_user",
      "nickname": "测试用户",
      "avatar": "avatar_url",
      "phone": "13800138000"
    }
  },
  "timestamp": 1746897859261
}
```

### 注册接口

- 请求方式：POST
- 接口路径：`/api/auth/register`
- 请求参数：

```json
{
  "account": "用户名",
  "password": "密码",
  "confirmPassword": "确认密码",
  "nickname": "昵称",
  "phone": "手机号"
}
```

- 响应示例：

```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "account": "test_user",
      "nickname": "测试用户",
      "phone": "13800138000"
    }
  },
  "timestamp": 1746897859261
}
```

## 4. 用户资料相关接口

### 获取用户资料

- 请求方式：GET
- 接口路径：`/api/user/profile`
- 请求头：需要包含Authorization头
- 响应示例：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "account": "test_user",
    "nickname": "测试用户",
    "avatar": "avatar_url",
    "phone": "13800138000",
    "gender": "male",
    "birth_date": "1990-01-01",
    "address": "内蒙古呼和浩特市",
    "created_at": "2023-01-01 12:00:00"
  },
  "timestamp": 1746897859261
}
```

### 更新用户资料

- 请求方式：PUT
- 接口路径：`/api/user/profile`
- 请求头：需要包含Authorization头
- 请求参数：

```json
{
  "nickname": "新昵称",
  "gender": "female",
  "birth_date": "1992-05-20",
  "address": "内蒙古乌兰察布市"
}
```

- 响应示例：

```json
{
  "code": 200,
  "message": "更新成功",
  "data": {
    "id": 1,
    "nickname": "新昵称",
    "gender": "female",
    "birth_date": "1992-05-20",
    "address": "内蒙古乌兰察布市"
  },
  "timestamp": 1746897859261
}
```

## 5. 文章相关接口

### 获取文章列表

- 请求方式：GET
- 接口路径：`/api/articles`
- 请求参数（URL参数）：
  - `page`: 页码，默认1
  - `per_page`: 每页数量，默认10
  - `category`: 分类ID（可选）
  - `tags`: 标签，多个用逗号分隔（可选）
  - `language`: 语言，默认'chinese'，可选'mongolian'

- 响应示例：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "items": [
      {
        "id": 1,
        "title": "健康生活小知识",
        "summary": "本文介绍了日常健康生活的小技巧...",
        "author": "健康专家",
        "cover_image": "image_url",
        "category": "日常保健",
        "tags": ["健康", "生活"],
        "created_at": "2023-05-01 10:30:00",
        "read_count": 1250
      },
      // 更多文章...
    ],
    "pagination": {
      "page": 1,
      "per_page": 10,
      "total": 42,
      "pages": 5
    }
  },
  "timestamp": 1746897859261
}
```

### 获取文章详情

- 请求方式：GET
- 接口路径：`/api/articles/<article_id>`
- 请求参数：无
- 响应示例：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "title": "健康生活小知识",
    "content": "## 健康生活小技巧\n\n1. 保持充足睡眠...",
    "author": "健康专家",
    "cover_image": "image_url",
    "category": "日常保健",
    "tags": ["健康", "生活"],
    "created_at": "2023-05-01 10:30:00",
    "read_count": 1251
  },
  "timestamp": 1746897859261
}
```

## 6. 问诊相关接口

### 创建问诊会话

- 请求方式：POST
- 接口路径：`/api/consult/sessions`
- 请求头：需要包含Authorization头
- 请求参数：

```json
{
  "title": "咨询感冒症状",
  "description": "最近有咳嗽症状，想咨询一下"
}
```

- 响应示例：

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "user_id": "user_123",
    "title": "咨询感冒症状",
    "description": "最近有咳嗽症状，想咨询一下",
    "status": "active",
    "created_at": "2023-05-10 15:30:00",
    "updated_at": "2023-05-10 15:30:00",
    "messages": [
      {
        "id": 1,
        "session_id": 1,
        "sender_type": "system",
        "content": "欢迎使用牧民健康智能问诊系统，请描述您的健康问题，我会尽力为您提供专业建议。",
        "content_type": "text",
        "created_at": "2023-05-10 15:30:00"
      }
    ]
  },
  "timestamp": 1746897859261
}
```

### 获取问诊会话列表

- 请求方式：GET
- 接口路径：`/api/consult/sessions`
- 请求头：需要包含Authorization头
- 请求参数（URL参数）：
  - `status`: 状态筛选，可选值：'active'/'closed'，不传则获取全部

- 响应示例：

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "user_id": "user_123",
      "title": "咨询感冒症状",
      "description": "最近有咳嗽症状，想咨询一下",
      "status": "active",
      "created_at": "2023-05-10 15:30:00",
      "updated_at": "2023-05-10 15:30:00"
    },
    // 更多会话...
  ],
  "timestamp": 1746897859261
}
```

### 获取问诊会话详情

- 请求方式：GET
- 接口路径：`/api/consult/sessions/<session_id>`
- 请求头：需要包含Authorization头
- 响应示例：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "user_id": "user_123",
    "title": "咨询感冒症状",
    "description": "最近有咳嗽症状，想咨询一下",
    "status": "active",
    "created_at": "2023-05-10 15:30:00",
    "updated_at": "2023-05-10 15:40:00",
    "messages": [
      {
        "id": 1,
        "session_id": 1,
        "sender_type": "system",
        "content": "欢迎使用牧民健康智能问诊系统，请描述您的健康问题，我会尽力为您提供专业建议。",
        "content_type": "text",
        "created_at": "2023-05-10 15:30:00"
      },
      {
        "id": 2,
        "session_id": 1,
        "sender_type": "user",
        "content": "我最近咳嗽，有点发热，请问是感冒了吗？",
        "content_type": "text",
        "created_at": "2023-05-10 15:35:00"
      },
      {
        "id": 3,
        "session_id": 1,
        "sender_type": "ai",
        "content": "您的症状确实可能是感冒。建议多休息，多喝水，如果体温超过38.5°C，请考虑就医。",
        "content_type": "text",
        "created_at": "2023-05-10 15:35:10"
      }
    ]
  },
  "timestamp": 1746897859261
}
```

### 发送问诊消息

- 请求方式：POST
- 接口路径：`/api/consult/sessions/<session_id>/messages`
- 请求头：需要包含Authorization头
- 请求参数：

```json
{
  "content": "我应该吃什么药？",
  "content_type": "text",
  "language": "chinese"  // 可选，默认为"chinese"，支持"mongolian"
}
```

- 响应示例：

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "user_message": {
      "id": 4,
      "session_id": 1,
      "sender_type": "user",
      "content": "我应该吃什么药？",
      "content_type": "text",
      "created_at": "2023-05-10 15:40:00"
    },
    "ai_message": {
      "id": 5,
      "session_id": 1,
      "sender_type": "ai",
      "content": "在没有医生具体诊断之前，您可以考虑使用一些缓解症状的药物，如布洛芬可以帮助退烧和缓解疼痛，感冒药如复方感冒片可帮助缓解鼻塞、咳嗽等症状。但如果症状严重或持续超过3天，建议及时就医。",
      "content_type": "text",
      "created_at": "2023-05-10 15:40:05"
    },
    "time_taken": 1.25  // AI响应时间（秒）
  },
  "timestamp": 1746897859261
}
```

### 语音问诊（上传音频）

- 请求方式：POST
- 接口路径：`/api/consult/sessions/<session_id>/audio`
- 请求头：需要包含Authorization头
- 请求参数：表单数据（multipart/form-data）
  - `audio`: 音频文件（支持mp3、wav格式）

- 响应示例：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "text": "我最近咳嗽得厉害，有什么建议？",
    "audio_url": "https://example.com/uploads/audio/123456.mp3",
    "message": {
      "id": 6,
      "session_id": 1,
      "sender_type": "user",
      "content": "我最近咳嗽得厉害，有什么建议？",
      "content_type": "audio",
      "media_url": "https://example.com/uploads/audio/123456.mp3",
      "created_at": "2023-05-10 15:45:00"
    }
  },
  "timestamp": 1746897859261
}
```

## 7. 健康资讯相关接口

### 获取健康资讯列表

- 请求方式：GET
- 接口路径：`/api/health/tips`
- 请求参数（URL参数）：
  - `page`: 页码，默认1
  - `per_page`: 每页数量，默认10
  - `language`: 语言，默认'chinese'，可选'mongolian'

- 响应示例：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "items": [
      {
        "id": 1,
        "title": "每日健康小贴士",
        "content": "多喝水可以帮助身体排毒...",
        "image_url": "image_url",
        "category": "生活习惯",
        "created_at": "2023-05-01 10:30:00"
      },
      // 更多健康资讯...
    ],
    "pagination": {
      "page": 1,
      "per_page": 10,
      "total": 30,
      "pages": 3
    }
  },
  "timestamp": 1746897859261
}
```

### 健康问答接口

- 请求方式：POST
- 接口路径：`/api/health/qa`
- 请求头：需要包含Authorization头
- 请求参数：

```json
{
  "query": "高血压患者应该注意什么？",
  "language": "chinese"  // 可选，默认为"chinese"，支持"mongolian"
}
```

- 响应示例：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "query": "高血压患者应该注意什么？",
    "response": "高血压患者应该注意以下几点：\n1. 限制钠盐摄入\n2. 规律测量血压\n3. 保持适当运动\n4. 避免情绪激动\n5. 按时服药\n6. 戒烟限酒",
    "time_taken": 1.35  // 响应时间（秒）
  },
  "timestamp": 1746897859261
}
```

## 8. 用户设置相关接口

### 获取用户设置

- 请求方式：GET
- 接口路径：`/api/settings`
- 请求头：需要包含Authorization头
- 响应示例：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "user_id": "user_123",
    "language": "zh-CN",
    "push_notification": true
  },
  "timestamp": 1746897859261
}
```

### 更新用户设置

- 请求方式：PUT
- 接口路径：`/api/settings`
- 请求头：需要包含Authorization头
- 请求参数：

```json
{
  "language": "mn-MN",
  "push_notification": false
}
```

- 响应示例：

```json
{
  "code": 200,
  "message": "更新成功",
  "data": {
    "id": 1,
    "user_id": "user_123",
    "language": "mn-MN",
    "push_notification": false
  },
  "timestamp": 1746897859261
}
```

## 9. 文件上传接口

### 上传图片

- 请求方式：POST
- 接口路径：`/api/upload/image`
- 请求头：需要包含Authorization头
- 请求参数：表单数据（multipart/form-data）
  - `image`: 图片文件（支持jpg、png、gif格式）
  - `type`: 上传类型，如'avatar'、'article'等

- 响应示例：

```json
{
  "code": 200,
  "message": "上传成功",
  "data": {
    "url": "https://example.com/uploads/images/avatar_123.jpg",
    "filename": "avatar_123.jpg",
    "size": 102400,
    "type": "avatar"
  },
  "timestamp": 1746897859261
}
```

## 10. 错误处理

前端开发者应该处理以下常见错误情况：

1. 网络错误
2. 服务器错误（500系列）
3. 身份验证错误（401）
4. 权限错误（403）
5. 请求参数错误（400）

示例错误处理代码（使用uni-app）：

```js
// 全局请求拦截器
uni.addInterceptor('request', {
  invoke(options) {
    // 添加token
    const token = uni.getStorageSync('token');
    if (token) {
      options.header = {
        ...options.header,
        'Authorization': `Bearer ${token}`
      };
    }
    return options;
  },
  success(response) {
    const { data } = response;
    
    // 处理成功响应
    if (data.code === 200) {
      return data;
    }
    
    // 处理错误情况
    switch (data.code) {
      case 401:
        // 未授权，跳转登录
        uni.showToast({ title: '登录已过期，请重新登录', icon: 'none' });
        uni.navigateTo({ url: '/pages/login/login' });
        break;
      case 403:
        uni.showToast({ title: '没有权限进行此操作', icon: 'none' });
        break;
      case 400:
        uni.showToast({ title: data.message || '请求参数错误', icon: 'none' });
        break;
      case 404:
        uni.showToast({ title: '请求的资源不存在', icon: 'none' });
        break;
      case 500:
        uni.showToast({ title: '服务器内部错误，请稍后再试', icon: 'none' });
        break;
      default:
        uni.showToast({ title: data.message || '未知错误', icon: 'none' });
    }
    
    return Promise.reject(data);
  },
  fail(error) {
    // 处理网络错误
    uni.showToast({ title: '网络连接失败，请检查网络设置', icon: 'none' });
    return Promise.reject(error);
  }
});
```

## 11. 开发环境配置

### 开发环境API地址

- 开发环境: `http://localhost:5000/api`
- 测试环境: `http://test-api.example.com/api`
- 生产环境: `https://api.example.com/api`

### 开发环境配置（uni-app）

```js
// config.js
const ENV = process.env.NODE_ENV;

const config = {
  development: {
    apiBaseUrl: 'http://localhost:5000/api'
  },
  test: {
    apiBaseUrl: 'http://test-api.example.com/api'
  },
  production: {
    apiBaseUrl: 'https://api.example.com/api'
  }
};

export default config[ENV] || config.development;
```

## 12. 联系与支持

如在API对接过程中遇到问题，请联系后端开发团队：

- 技术支持邮箱：support@example.com
- 问题反馈：可在系统内提交反馈
- API文档更新日期：2025年5月11日

---

本文档将根据API变更持续更新，请前端开发人员定期查看最新版本。 